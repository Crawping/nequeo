<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title></title>
    <style type="text/css">
.cl_CollapsibleArea_expanding {background: url('ms-xhelp:///?76555C51-8CF1-4FEB-81C4-BED857D94EBB_EN-US_Microsoft;/imageSprite.png') -1px -3px;}.OH_footer { background-image: url('ms-xhelp:///?76555C51-8CF1-4FEB-81C4-BED857D94EBB_EN-US_Microsoft;/footer_slice.gif'); background-position:top; background-repeat:repeat-x}</style>
</head>
<body>

<SCRIPT>setUserPreferenceLang('1');</SCRIPT>

    <div class="OH_outerDiv">
        <div class="OH_outerContent">
            <div class="OH_topic">
                <div class="OH_title">
                    <table>
                        <tr>
                            <td class="OH_tdTitleColumn">How to: Run Partially Trusted Code in a Sandbox</td>
                            <td class="OH_tdLogoColumn">
                                <img id="VSLogo" alt="Visual Studio 2013" src="ms-xhelp:///?76555C51-8CF1-4FEB-81C4-BED857D94EBB_EN-US_Microsoft;/vs_logo_bk.gif" title="Visual Studio 2013" /><img id="VSLogoHC" alt="Visual Studio 2013" src="ms-xhelp:///?76555C51-8CF1-4FEB-81C4-BED857D94EBB_EN-US_Microsoft;/vs_logo_wh.gif" style="DISPLAY: none" title="Visual Studio 2013" /></td>
                        </tr>
                    </table>
                </div>
            </div>
            <table style="WIDTH: 97%">
                <tr>
                    <td style="TEXT-ALIGN: left">
                        <div class="OH_feedbacklink">
                            <a href="mailto:DevDocs@Microsoft.com?subject=MSDN%5e*bb763046%5e*VS%5e*110%5e*EN-US&amp;body=Visual%20Studio%20feedback%20policy%3a%20http%3a%2f%2fmsdn.microsoft.com%2fEN-US%2flibrary%2fee264131(VS.110).aspx">Send Feedback</a> on this topic to Microsoft.</div>
                    </td>
                    <td style="TEXT-ALIGN: right">
                        <div class="OH_feedbacklink">
                            <img alt="Online" class="OH_offlineIcon" src="ms-xhelp:///?76555C51-8CF1-4FEB-81C4-BED857D94EBB_EN-US_Microsoft;/online_icon.gif" title="Online" /><span>View this topic <a href="http://msdn.microsoft.com/EN-US/library/bb763046(v=VS.110,d=hv.2).aspx" target="_blank">online</a> in your default browser.</span></div>
                    </td>
                </tr>
            </table>
            <div id="mainSection" xmlns="http://www.w3.org/1999/xhtml">
                <div id="mainBody">
                    <p>
                    </p>
                    <div class="introduction">
                        <p>
                            Sandboxing is the practice of running code in a restricted security environment, which limits the access permissions granted to the code. For example, if you have a managed library from a source you do not completely trust, you should not run it as fully trusted. Instead, you should place the code in a sandbox that limits its permissions to those that you expect it to need (for example, <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.permissions.securitypermissionflag&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">Execution</a></span> permission).</p>
                        <p>
                            You can also use sandboxing to test code you will be distributing that will run in partially trusted environments.</p>
                        <p>
                            An <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> is an effective way of providing a sandbox for managed applications. Application domains that are used for running partially trusted code have permissions that define the protected resources that are available when running within that <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span>. Code that runs inside the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> is bound by the permissions associated with the <span>
                            <a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> and is allowed to access only the specified resources. The <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> also includes a <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.policy.strongname&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">StrongName</a></span> array that is used to identify assemblies that are to be loaded as fully trusted. This enables the creator of an <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> to start a new sandboxed domain that allows specific helper assemblies to 
                            be fully trusted. Another option for loading assemblies as fully trusted is to place them in the global assembly cache; however, that will load assemblies as fully trusted in all application domains created on that computer. The list of strong names supports a per-<span> <a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> decision that provides more restrictive determination.</p>
                        <p>
                            You can use the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.appdomain.createdomain(system.string%2csystem.security.policy.evidence%2csystem.appdomainsetup%2csystem.security.permissionset%2csystem.security.policy.strongname%5b%5d)&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain<span id="ID65">.</span>
<SCRIPT>addToLanSpecTextIdSet('ID65?cs=.|vb=.|cpp=::|nu=.');</SCRIPT>
                            CreateDomain(String, Evidence, AppDomainSetup, PermissionSet,<span id="ID66"></span>
<SCRIPT>addToLanSpecTextIdSet('ID66?cs=|vb=|cpp=array&lt;|nu=');</SCRIPT>
                            StrongName<span id="ID67">[]</span>
<SCRIPT>addToLanSpecTextIdSet('ID67?cs=[]|vb=()|cpp=&gt;|nu=[]');</SCRIPT>
                            )</a></span> method overload to specify the permission set for applications that run in a sandbox. This overload enables you to specify the exact level of code access security you want. Assemblies that are loaded into an<span> <a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> by using this overload can either have the specified grant set only, or can be fully trusted. The assembly is granted full trust if it is in the global assembly cache or listed in the <span class="parameter">fullTrustAssemblies</span> (the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.policy.strongname&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">StrongName</a></span>) array parameter. Only assemblies known to be fully trusted should be added to the <span class="parameter">fullTrustAssemblies</span> list.</p>
                        <p>
                            The overload has the following signature:</p>
                        <div id="ID76" class="OH_CodeSnippetContainer">
                            <div id="ID76_tabs" class="OH_CodeSnippetContainerTabs">
                                <div id="ID76_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                </div>
                            </div>
                            <div id="ID76_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                <div class="OH_CodeSnippetToolBar">
                                    <div class="OH_CodeSnippetToolBarText">
                                        <a id="ID76_ViewColorized" href="javascript:ExchangeTitleContent('ID76','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID76_copycode" href="javascript:CopyToClipboard('ID76','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                </div>
                                <div id="ID76_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                    <pre>AppDomain.CreateDomain(&nbsp;string friendlyName,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Evidence securityInfo,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AppDomainSetup info,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PermissionSet grantSet,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params StrongName[] fullTrustAssemblies);</pre>
                                </div>
                                <div id="ID76_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                    <pre>AppDomain.CreateDomain(&nbsp;string friendlyName,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Evidence securityInfo,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;AppDomainSetup info,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PermissionSet grantSet,
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;params StrongName[] fullTrustAssemblies);</pre>
                                </div>
                            </div>
                        </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID76');</SCRIPT>

                        <p>
                            The parameters for the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.appdomain.createdomain(system.string%2csystem.security.policy.evidence%2csystem.appdomainsetup%2csystem.security.permissionset%2csystem.security.policy.strongname%5b%5d)&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">CreateDomain(String, Evidence, AppDomainSetup, PermissionSet,<span id="ID80"></span>
<SCRIPT>addToLanSpecTextIdSet('ID80?cs=|vb=|cpp=array&lt;|nu=');</SCRIPT>
                            StrongName<span id="ID81">[]</span>
<SCRIPT>addToLanSpecTextIdSet('ID81?cs=[]|vb=()|cpp=&gt;|nu=[]');</SCRIPT>
                            )</a></span> method overload specify the name of the<span> <a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span>, the evidence for the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span>, the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomainsetup&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomainSetup</a></span> object that identifies the application base for the sandbox, the permission set to use, and the strong names for fully trusted assemblies.</p>
                        <p>
                            For security reasons, the application base specified in the <span class="parameter">info</span> parameter should not be the application base for the hosting application.</p>
                        <p>
                            For the <span class="parameter">grantSet</span> parameter, you can specify either a permission set you have explicitly created, or a standard permission set created by the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.security.securitymanager.getstandardsandbox(system.security.policy.evidence)&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">GetStandardSandbox</a></span> method.</p>
                        <p>
                            Unlike most <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> loads, the evidence for the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> (which is provided by the <span class="parameter">securityInfo</span> parameter) is not used to determine the grant set for the partially trusted assemblies. Instead, it is independently specified by the <span class="parameter">grantSet</span> parameter. However, the evidence can be used for other purposes such as determining the isolated storage scope.</p>
                    </div>
                    <h3 class="procedureSubHeading">To run an application in a sandbox</h3>
                    <div class="subSection">
                        <ol>
                            <li>
                                <p>
                                    Create the permission set to be granted to the untrusted application. The minimum permission you can grant is <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.permissions.securitypermissionflag&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">Execution</a></span> permission. You can also grant additional permissions you think might be safe for untrusted code; for example, <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.permissions.isolatedstoragefilepermission&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">IsolatedStorageFilePermission</a></span>. The following code creates a new permission set with only <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.permissions.securitypermissionflag&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">Execution</a></span> permission.</p>
                                <div id="ID113" class="OH_CodeSnippetContainer">
                                    <div id="ID113_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID113_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID113_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID113_ViewColorized" href="javascript:ExchangeTitleContent('ID113','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID113_copycode" href="javascript:CopyToClipboard('ID113','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID113_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>PermissionSet permSet = new PermissionSet(PermissionState.None);
permSet.AddPermission(new SecurityPermission(SecurityPermissionFlag.Execution));</pre>
                                        </div>
                                        <div id="ID113_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>PermissionSet permSet = new PermissionSet(PermissionState.None);
permSet.AddPermission(new SecurityPermission(SecurityPermissionFlag.Execution));</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID113');</SCRIPT>

                                <p>
                                    Alternatively, you can use an existing named permission set, such as Internet.</p>
                                <div id="ID116" class="OH_CodeSnippetContainer">
                                    <div id="ID116_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID116_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID116_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID116_ViewColorized" href="javascript:ExchangeTitleContent('ID116','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID116_copycode" href="javascript:CopyToClipboard('ID116','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID116_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>Evidence ev = new Evidence();
ev.AddHostEvidence(new Zone(SecurityZone.Internet));
PermissionSet internetPS = SecurityManager.GetStandardSandbox(ev);</pre>
                                        </div>
                                        <div id="ID116_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>Evidence ev = new Evidence();
ev.AddHostEvidence(new Zone(SecurityZone.Internet));
PermissionSet internetPS = SecurityManager.GetStandardSandbox(ev);</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID116');</SCRIPT>

                                <p>
                                    The <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.security.securitymanager.getstandardsandbox(system.security.policy.evidence)&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">GetStandardSandbox</a></span> method returns either an <span><span class="input">Internet</span></span> permission set or a <span><span class="input">LocalIntranet</span></span> permission set depending on the zone in the evidence. <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.security.securitymanager.getstandardsandbox(system.security.policy.evidence)&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">GetStandardSandbox</a></span> also constructs identity permissions for some of the evidence objects passed as references.</p>
                            </li>
                            <li>
                                <p>
                                    Sign the assembly that contains the hosting class (named <span class="code">Sandboxer</span> in this example) that calls the untrusted code. Add the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.policy.strongname&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">StrongName</a></span> used to sign the assembly to the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.policy.strongname&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">StrongName</a></span> array of the <span class="parameter">fullTrustAssemblies</span> parameter of the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=overload%3asystem.appdomain.createdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">CreateDomain</a></span> call. The hosting class must run as fully trusted to enable the execution of the partial-trust code or to offer services to the 
                                    partial-trust application. This is how you read the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.policy.strongname&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">StrongName</a></span> of an assembly:</p>
                                <div id="ID139" class="OH_CodeSnippetContainer">
                                    <div id="ID139_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID139_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID139_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID139_ViewColorized" href="javascript:ExchangeTitleContent('ID139','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID139_copycode" href="javascript:CopyToClipboard('ID139','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID139_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>StrongName fullTrustAssembly = typeof(Sandboxer).Assembly.Evidence.GetHostEvidence&lt;StrongName&gt;();</pre>
                                        </div>
                                        <div id="ID139_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>StrongName fullTrustAssembly = typeof(Sandboxer).Assembly.Evidence.GetHostEvidence&lt;StrongName&gt;();</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID139');</SCRIPT>

                                <p>
                                    .NET Framework assemblies such as mscorlib and System.dll do not have to be added to the full-trust list because they are loaded as fully trusted from the global assembly cache.</p>
                            </li>
                            <li>
                                <p>
                                    Initialize the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomainsetup&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomainSetup</a></span> parameter of the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=overload%3asystem.appdomain.createdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">CreateDomain</a></span> method. With this parameter, you can control many of the settings of the new <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span>. The <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=p%3asystem.appdomainsetup.applicationbase&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">ApplicationBase</a></span> property is an important setting, and should be different from the <span>
                                    <a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=p%3asystem.appdomainsetup.applicationbase&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">ApplicationBase</a></span> property for the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> of the hosting application. If the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=p%3asystem.appdomainsetup.applicationbase&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">ApplicationBase</a></span> settings are the same, the partial-trust application can get the hosting application to load (as fully trusted) an exception it defines, thus exploiting it. This is another reason why a catch (exception) is not recommended. Setting the application base of the host differently from the application base of the sandboxed application mitigates the risk of 
                                    exploits.</p>
                                <div id="ID158" class="OH_CodeSnippetContainer">
                                    <div id="ID158_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID158_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID158_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID158_ViewColorized" href="javascript:ExchangeTitleContent('ID158','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID158_copycode" href="javascript:CopyToClipboard('ID158','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID158_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>AppDomainSetup adSetup = new AppDomainSetup();
adSetup.ApplicationBase = Path.GetFullPath(pathToUntrusted);</pre>
                                        </div>
                                        <div id="ID158_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>AppDomainSetup adSetup = new AppDomainSetup();
adSetup.ApplicationBase = Path.GetFullPath(pathToUntrusted);</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID158');</SCRIPT>

                                <p>
                                </p>
                            </li>
                            <li>
                                <p>
                                    Call the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.appdomain.createdomain(system.string%2csystem.security.policy.evidence%2csystem.appdomainsetup%2csystem.security.permissionset%2csystem.security.policy.strongname%5b%5d)&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">CreateDomain(String, Evidence, AppDomainSetup, PermissionSet,<span id="ID164"></span>
<SCRIPT>addToLanSpecTextIdSet('ID164?cs=|vb=|cpp=array&lt;|nu=');</SCRIPT>
                                    StrongName<span id="ID165">[]</span>
<SCRIPT>addToLanSpecTextIdSet('ID165?cs=[]|vb=()|cpp=&gt;|nu=[]');</SCRIPT>
                                    )</a></span> method overload to create the application domain using the parameters we have specified.</p>
                                <p>
                                    The signature for this method is:</p>
                                <div id="ID168" class="OH_CodeSnippetContainer">
                                    <div id="ID168_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID168_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID168_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID168_ViewColorized" href="javascript:ExchangeTitleContent('ID168','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID168_copycode" href="javascript:CopyToClipboard('ID168','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID168_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>public static AppDomain CreateDomain(string friendlyName, 
    Evidence securityInfo, AppDomainSetup info, PermissionSet grantSet, 
    params StrongName[] fullTrustAssemblies)</pre>
                                        </div>
                                        <div id="ID168_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>public static AppDomain CreateDomain(string friendlyName, 
    Evidence securityInfo, AppDomainSetup info, PermissionSet grantSet, 
    params StrongName[] fullTrustAssemblies)</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID168');</SCRIPT>

                                <p>
                                    Additional information:</p>
                                <ul>
                                    <li>
                                        <p>
                                            This is the only overload of the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=overload%3asystem.appdomain.createdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">CreateDomain</a></span> method that takes a <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.permissionset&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">PermissionSet</a></span> as a parameter, and thus the only overload that lets you load an application in a partial-trust setting.</p>
                                    </li>
                                    <li>
                                        <p>
                                            The <span class="parameter">evidence</span> parameter is not used to calculate a permission set; it is used for identification by other features of the .NET Framework.</p>
                                    </li>
                                    <li>
                                        <p>
                                            Setting the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=p%3asystem.appdomainsetup.applicationbase&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">ApplicationBase</a></span> property of the <span class="parameter">info</span> parameter is mandatory for this overload.</p>
                                    </li>
                                    <li>
                                        <p>
                                            The <span class="parameter">fullTrustAssemblies</span> parameter has the <span class="code">params</span> keyword, which means that it is not necessary to create a <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.policy.strongname&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">StrongName</a></span> array. Passing 0, 1, or more strong names as parameters is allowed.</p>
                                    </li>
                                    <li>
                                        <p>
                                            The code to create the application domain is:</p>
                                    </li>
                                </ul>
                                <div id="ID194" class="OH_CodeSnippetContainer">
                                    <div id="ID194_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID194_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID194_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID194_ViewColorized" href="javascript:ExchangeTitleContent('ID194','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID194_copycode" href="javascript:CopyToClipboard('ID194','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID194_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>AppDomain newDomain = AppDomain.CreateDomain(&quot;Sandbox&quot;, null, adSetup, permSet, fullTrustAssembly);</pre>
                                        </div>
                                        <div id="ID194_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>AppDomain newDomain = AppDomain.CreateDomain(&quot;Sandbox&quot;, null, adSetup, permSet, fullTrustAssembly);</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID194');</SCRIPT>

                            </li>
                            <li>
                                <p>
                                    Load the code into the sandboxing <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> that you created. This can be done in two ways:</p>
                                <ul>
                                    <li>
                                        <p>
                                            Call the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=overload%3asystem.appdomain.executeassembly&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">ExecuteAssembly</a></span> method for the assembly.</p>
                                    </li>
                                    <li>
                                        <p>
                                            Use the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=overload%3asystem.activator.createinstancefrom&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">CreateInstanceFrom</a></span> method to create an instance of a class derived from <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.marshalbyrefobject&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">MarshalByRefObject</a></span> in the new <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span>.</p>
                                    </li>
                                </ul>
                                <p>
                                    The second method is preferable, because it makes it easier to pass parameters to the new <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.appdomain&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">AppDomain</a></span> instance. The <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=overload%3asystem.activator.createinstancefrom&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">CreateInstanceFrom</a></span> method provides two important features:</p>
                                <ul>
                                    <li>
                                        <p>
                                            You can use a code base that points to a location that does not contain your assembly.</p>
                                    </li>
                                    <li>
                                        <p>
                                            You can do the creation under an <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.security.codeaccesspermission.assert&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">Assert</a></span> for full-trust (<span> <a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.permissions.permissionstate&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">PermissionState<span id="ID226">.</span>
<SCRIPT>addToLanSpecTextIdSet('ID226?cs=.|vb=.|cpp=::|nu=.');</SCRIPT>
                                            Unrestricted</a></span>), which enables you to create an instance of a critical class. (This happens whenever your assembly has no transparency markings and is loaded as fully trusted.) Therefore, you have to be careful to create only code that you trust with this function, and we recommend that you create only instances of fully trusted classes in the new application domain.</p>
                                    </li>
                                </ul>
                                <div id="ID228" class="OH_CodeSnippetContainer">
                                    <div id="ID228_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID228_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID228_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID228_ViewColorized" href="javascript:ExchangeTitleContent('ID228','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID228_copycode" href="javascript:CopyToClipboard('ID228','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID228_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>ObjectHandle handle = Activator.CreateInstanceFrom(
newDomain, typeof(Sandboxer).Assembly.ManifestModule.FullyQualifiedName,
       typeof(Sandboxer).FullName );</pre>
                                        </div>
                                        <div id="ID228_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>ObjectHandle handle = Activator.CreateInstanceFrom(
newDomain, typeof(Sandboxer).Assembly.ManifestModule.FullyQualifiedName,
       typeof(Sandboxer).FullName );</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID228');</SCRIPT>

                                <p>
                                    Note that in order to create an instance of a class in a new domain, the class has to extend the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.marshalbyrefobject&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">MarshalByRefObject</a></span> class</p>
                                <div id="ID233" class="OH_CodeSnippetContainer">
                                    <div id="ID233_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID233_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID233_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID233_ViewColorized" href="javascript:ExchangeTitleContent('ID233','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID233_copycode" href="javascript:CopyToClipboard('ID233','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID233_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>class Sandboxer:MarshalByRefObject</pre>
                                        </div>
                                        <div id="ID233_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>class Sandboxer:MarshalByRefObject</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID233');</SCRIPT>

                            </li>
                            <li>
                                <p>
                                    Unwrap the new domain instance into a reference in this domain. This reference is used to execute the untrusted code.</p>
                                <div id="ID237" class="OH_CodeSnippetContainer">
                                    <div id="ID237_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID237_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID237_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID237_ViewColorized" href="javascript:ExchangeTitleContent('ID237','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID237_copycode" href="javascript:CopyToClipboard('ID237','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID237_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>Sandboxer newDomainInstance = (Sandboxer) handle.Unwrap();</pre>
                                        </div>
                                        <div id="ID237_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>Sandboxer newDomainInstance = (Sandboxer) handle.Unwrap();</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID237');</SCRIPT>

                            </li>
                            <li>
                                <p>
                                    Call the <span class="code">ExecuteUntrustedCode</span> method in the instance of the <span class="code">Sandboxer</span> class you just created.</p>
                                <div id="ID243" class="OH_CodeSnippetContainer">
                                    <div id="ID243_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID243_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID243_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID243_ViewColorized" href="javascript:ExchangeTitleContent('ID243','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID243_copycode" href="javascript:CopyToClipboard('ID243','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID243_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>newDomainInstance.ExecuteUntrustedCode(untrustedAssembly, untrustedClass, entryPoint, parameters);</pre>
                                        </div>
                                        <div id="ID243_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>newDomainInstance.ExecuteUntrustedCode(untrustedAssembly, untrustedClass, entryPoint, parameters);</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID243');</SCRIPT>

                                <p>
                                    This call is executed in the sandboxed application domain, which has restricted permissions.</p>
                                <div id="ID246" class="OH_CodeSnippetContainer">
                                    <div id="ID246_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID246_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID246_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID246_ViewColorized" href="javascript:ExchangeTitleContent('ID246','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID246_copycode" href="javascript:CopyToClipboard('ID246','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID246_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>public void ExecuteUntrustedCode(string assemblyName, string typeName, string entryPoint, Object[] parameters)
    {
        //Load the MethodInfo for a method in the new assembly. This might be a method you know, or 
        //you can use Assembly.EntryPoint to get to the entry point in an executable.
        MethodInfo target = Assembly.Load(assemblyName).GetType(typeName).GetMethod(entryPoint);
        try
        {
            // Invoke the method.
            target.Invoke(null, parameters);
        }
        catch (Exception ex)
        {
        //When information is obtained from a SecurityException extra information is provided if it is 
        //accessed in full-trust.
            (new PermissionSet(PermissionState.Unrestricted)).Assert();
            Console.WriteLine(&quot;SecurityException caught:\n{0}&quot;, ex.ToString());
CodeAccessPermission.RevertAssert();
            Console.ReadLine();
        }
    }</pre>
                                        </div>
                                        <div id="ID246_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>public void ExecuteUntrustedCode(string assemblyName, string typeName, string entryPoint, Object[] parameters)
    {
        //Load the MethodInfo for a method in the new assembly. This might be a method you know, or 
        //you can use Assembly.EntryPoint to get to the entry point in an executable.
        MethodInfo target = Assembly.Load(assemblyName).GetType(typeName).GetMethod(entryPoint);
        try
        {
            // Invoke the method.
            target.Invoke(null, parameters);
        }
        catch (Exception ex)
        {
        //When information is obtained from a SecurityException extra information is provided if it is 
        //accessed in full-trust.
            (new PermissionSet(PermissionState.Unrestricted)).Assert();
            Console.WriteLine(&quot;SecurityException caught:\n{0}&quot;, ex.ToString());
CodeAccessPermission.RevertAssert();
            Console.ReadLine();
        }
    }</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID246');</SCRIPT>

                                <p>
                                    <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=n%3asystem.reflection&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">System.Reflection</a></span> is used to get a handle of a method in the partially trusted assembly. The handle can be used to execute code in a safe way with minimum permissions.</p>
                                <p>
                                    In the previous code, note the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.security.permissionset.assert&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">Assert</a></span> for the full-trust permission before printing the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.securityexception&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">SecurityException</a></span>.</p>
                                <div id="ID256" class="OH_CodeSnippetContainer">
                                    <div id="ID256_tabs" class="OH_CodeSnippetContainerTabs">
                                        <div id="ID256_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                        </div>
                                    </div>
                                    <div id="ID256_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                        <div class="OH_CodeSnippetToolBar">
                                            <div class="OH_CodeSnippetToolBarText">
                                                <a id="ID256_ViewColorized" href="javascript:ExchangeTitleContent('ID256','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID256_copycode" href="javascript:CopyToClipboard('ID256','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                        </div>
                                        <div id="ID256_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                            <pre>new PermissionSet(PermissionState.Unrestricted)).Assert()</pre>
                                        </div>
                                        <div id="ID256_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                            <pre>new PermissionSet(PermissionState.Unrestricted)).Assert()</pre>
                                        </div>
                                    </div>
                                </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID256');</SCRIPT>

                                <p>
                                    The full-trust assert is used to obtain extended information from the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.securityexception&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">SecurityException</a></span>. Without the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.security.permissionset.assert&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">Assert</a></span>, the <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=m%3asystem.security.securityexception.tostring&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">ToString</a></span> method of <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.securityexception&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">SecurityException</a></span> will discover that there is partially trusted code on the stack and will restrict the 
                                    information returned. This could cause security issues if the partial-trust code could read that information, but the risk is mitigated by not granting <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=t%3asystem.security.permissions.uipermission&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">UIPermission</a></span>. The full-trust assert should be used sparingly and only when you are sure that you are not allowing partial-trust code to elevate to full trust. As a rule, do not call code you do not trust in the same function and after you called an assert for full trust. It is good practice to always revert the assert when you have finished using it.</p>
                            </li>
                        </ol>
                    </div>
                    <div>
                        <div class="OH_CollapsibleArea_TitleDiv">
                            <div>
                                <a id="ID268" class="OH_CollapsibleArea_TitleAhref" href="javascript:void(0)" onclick="javascript:CA_Click('ID268','Expand','Collapse')" title="Collapse">
                                <img id="ID268_img" class="cl_CollapsibleArea_expanding OH_CollapsibleArea_Img" src="ms-xhelp:///?76555C51-8CF1-4FEB-81C4-BED857D94EBB_EN-US_Microsoft;/clear.gif" /><span class="OH_CollapsibleArea_Title">Example</span></a>
<SCRIPT>addToCollapsibleControlSet('ID268');</SCRIPT>

                                <div class="OH_CollapsibleArea_HrDiv">
                                    <hr class="OH_CollapsibleArea_Hr" />
                                </div>
                            </div>
                        </div>
                        <div id="ID268_c" class="sectionblock">
                            <a id="exampleToggle"></a>
                            <p>
                                The following example implements the procedure in the previous section. In the example, a project named <span class="code">Sandboxer</span> in a Visual Studio solution also contains a project named <span class="code">UntrustedCode</span>, which implements the class <span class="code">UntrustedClass</span>. This scenario assumes that you have downloaded a library assembly containing a method that is expected to return <span><span class="input">true</span></span> or <span><span class="input">false</span></span> to indicate whether the number you provided is a Fibonacci number. Instead, the method attempts to read a file from your computer. The following example shows the untrusted code.</p>
                            <div id="ID279" class="OH_CodeSnippetContainer">
                                <div id="ID279_tabs" class="OH_CodeSnippetContainerTabs">
                                    <div id="ID279_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                    </div>
                                </div>
                                <div id="ID279_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                    <div class="OH_CodeSnippetToolBar">
                                        <div class="OH_CodeSnippetToolBarText">
                                            <a id="ID279_ViewColorized" href="javascript:ExchangeTitleContent('ID279','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID279_copycode" href="javascript:CopyToClipboard('ID279','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                    </div>
                                    <div id="ID279_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                        <pre>using System;
using System.IO;
namespace UntrustedCode
{
    public class UntrustedClass
    {
        // Pretend to be a method checking if a number is a Fibonacci
        // but which actually attempts to read a file.
        public static bool IsFibonacci(int number)
        {
           File.ReadAllText(&quot;C:\\Temp\\file.txt&quot;);
           return false;
        }
    }
}</pre>
                                    </div>
                                    <div id="ID279_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                        <pre>using System;
using System.IO;
namespace UntrustedCode
{
    public class UntrustedClass
    {
        // Pretend to be a method checking if a number is a Fibonacci
        // but which actually attempts to read a file.
        public static bool IsFibonacci(int number)
        {
           File.ReadAllText(&quot;C:\\Temp\\file.txt&quot;);
           return false;
        }
    }
}</pre>
                                    </div>
                                </div>
                            </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID279');</SCRIPT>

                            <p>
                                The following example shows the <span class="code">Sandboxer</span> application code that executes the untrusted code.</p>
                            <div id="ID283" class="OH_CodeSnippetContainer">
                                <div id="ID283_tabs" class="OH_CodeSnippetContainerTabs">
                                    <div id="ID283_tab1" class="OH_CodeSnippetContainerTabSolo" enablecopycode="true">
                                    </div>
                                </div>
                                <div id="ID283_codecollection" class="OH_CodeSnippetContainerCodeCollection">
                                    <div class="OH_CodeSnippetToolBar">
                                        <div class="OH_CodeSnippetToolBarText">
                                            <a id="ID283_ViewColorized" href="javascript:ExchangeTitleContent('ID283','6')" style="DISPLAY: none" title="View Colorized">View Colorized</a><a id="ID283_copycode" href="javascript:CopyToClipboard('ID283','6')" title="Copy to Clipboard">Copy to Clipboard</a></div>
                                    </div>
                                    <div id="ID283_code_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: block">
                                        <pre>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;
using System.Security;
using System.Security.Policy;
using System.Security.Permissions;
using System.Reflection;
using System.Runtime.Remoting;

//The Sandboxer class needs to derive from MarshalByRefObject so that we can create it in another 
// AppDomain and refer to it from the default AppDomain.
class Sandboxer : MarshalByRefObject
{
    const string pathToUntrusted = @&quot;..\..\..\UntrustedCode\bin\Debug&quot;;
    const string untrustedAssembly = &quot;UntrustedCode&quot;;
    const string untrustedClass = &quot;UntrustedCode.UntrustedClass&quot;;
    const string entryPoint = &quot;IsFibonacci&quot;;
    private static Object[] parameters = { 45 };
    static void Main()
    {
        //Setting the AppDomainSetup. It is very important to set the ApplicationBase to a folder 
        //other than the one in which the sandboxer resides.
        AppDomainSetup adSetup = new AppDomainSetup();
        adSetup.ApplicationBase = Path.GetFullPath(pathToUntrusted);

        //Setting the permissions for the AppDomain. We give the permission to execute and to 
        //read/discover the location where the untrusted code is loaded.
        PermissionSet permSet = new PermissionSet(PermissionState.None);
        permSet.AddPermission(new SecurityPermission(SecurityPermissionFlag.Execution));

        //We want the sandboxer assembly&#39;s strong name, so that we can add it to the full trust list.
        StrongName fullTrustAssembly = typeof(Sandboxer).Assembly.Evidence.GetHostEvidence&lt;StrongName&gt;();

        //Now we have everything we need to create the AppDomain, so let&#39;s create it.
        AppDomain newDomain = AppDomain.CreateDomain(&quot;Sandbox&quot;, null, adSetup, permSet, fullTrustAssembly);

        //Use CreateInstanceFrom to load an instance of the Sandboxer class into the
        //new AppDomain. 
        ObjectHandle handle = Activator.CreateInstanceFrom(
            newDomain, typeof(Sandboxer).Assembly.ManifestModule.FullyQualifiedName,
            typeof(Sandboxer).FullName
            );
        //Unwrap the new domain instance into a reference in this domain and use it to execute the 
        //untrusted code.
        Sandboxer newDomainInstance = (Sandboxer) handle.Unwrap();
        newDomainInstance.ExecuteUntrustedCode(untrustedAssembly, untrustedClass, entryPoint, parameters);
    }
    public void ExecuteUntrustedCode(string assemblyName, string typeName, string entryPoint, Object[] parameters)
    {
        //Load the MethodInfo for a method in the new Assembly. This might be a method you know, or 
        //you can use Assembly.EntryPoint to get to the main function in an executable.
        MethodInfo target = Assembly.Load(assemblyName).GetType(typeName).GetMethod(entryPoint);
        try
        {
            //Now invoke the method.
            bool retVal = (bool)target.Invoke(null, parameters);
        }
        catch (Exception ex)
        {
            // When we print informations from a SecurityException extra information can be printed if we are 
            //calling it with a full-trust stack.
            (new PermissionSet(PermissionState.Unrestricted)).Assert();
            Console.WriteLine(&quot;SecurityException caught:\n{0}&quot;, ex.ToString());
            CodeAccessPermission.RevertAssert();
            Console.ReadLine();
        }
    }
}</pre>
                                    </div>
                                    <div id="ID283_code_Plain_Div1" class="OH_CodeSnippetContainerCode" style="DISPLAY: none">
                                        <pre>using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.IO;
using System.Security;
using System.Security.Policy;
using System.Security.Permissions;
using System.Reflection;
using System.Runtime.Remoting;

//The Sandboxer class needs to derive from MarshalByRefObject so that we can create it in another 
// AppDomain and refer to it from the default AppDomain.
class Sandboxer : MarshalByRefObject
{
    const string pathToUntrusted = @&quot;..\..\..\UntrustedCode\bin\Debug&quot;;
    const string untrustedAssembly = &quot;UntrustedCode&quot;;
    const string untrustedClass = &quot;UntrustedCode.UntrustedClass&quot;;
    const string entryPoint = &quot;IsFibonacci&quot;;
    private static Object[] parameters = { 45 };
    static void Main()
    {
        //Setting the AppDomainSetup. It is very important to set the ApplicationBase to a folder 
        //other than the one in which the sandboxer resides.
        AppDomainSetup adSetup = new AppDomainSetup();
        adSetup.ApplicationBase = Path.GetFullPath(pathToUntrusted);

        //Setting the permissions for the AppDomain. We give the permission to execute and to 
        //read/discover the location where the untrusted code is loaded.
        PermissionSet permSet = new PermissionSet(PermissionState.None);
        permSet.AddPermission(new SecurityPermission(SecurityPermissionFlag.Execution));

        //We want the sandboxer assembly&#39;s strong name, so that we can add it to the full trust list.
        StrongName fullTrustAssembly = typeof(Sandboxer).Assembly.Evidence.GetHostEvidence&lt;StrongName&gt;();

        //Now we have everything we need to create the AppDomain, so let&#39;s create it.
        AppDomain newDomain = AppDomain.CreateDomain(&quot;Sandbox&quot;, null, adSetup, permSet, fullTrustAssembly);

        //Use CreateInstanceFrom to load an instance of the Sandboxer class into the
        //new AppDomain. 
        ObjectHandle handle = Activator.CreateInstanceFrom(
            newDomain, typeof(Sandboxer).Assembly.ManifestModule.FullyQualifiedName,
            typeof(Sandboxer).FullName
            );
        //Unwrap the new domain instance into a reference in this domain and use it to execute the 
        //untrusted code.
        Sandboxer newDomainInstance = (Sandboxer) handle.Unwrap();
        newDomainInstance.ExecuteUntrustedCode(untrustedAssembly, untrustedClass, entryPoint, parameters);
    }
    public void ExecuteUntrustedCode(string assemblyName, string typeName, string entryPoint, Object[] parameters)
    {
        //Load the MethodInfo for a method in the new Assembly. This might be a method you know, or 
        //you can use Assembly.EntryPoint to get to the main function in an executable.
        MethodInfo target = Assembly.Load(assemblyName).GetType(typeName).GetMethod(entryPoint);
        try
        {
            //Now invoke the method.
            bool retVal = (bool)target.Invoke(null, parameters);
        }
        catch (Exception ex)
        {
            // When we print informations from a SecurityException extra information can be printed if we are 
            //calling it with a full-trust stack.
            (new PermissionSet(PermissionState.Unrestricted)).Assert();
            Console.WriteLine(&quot;SecurityException caught:\n{0}&quot;, ex.ToString());
            CodeAccessPermission.RevertAssert();
            Console.ReadLine();
        }
    }
}</pre>
                                    </div>
                                </div>
                            </div>
<SCRIPT>addSpecificTextLanguageTagSet('ID283');</SCRIPT>
                        </div>
                    </div>
                    <div>
                        <div class="OH_CollapsibleArea_TitleDiv">
                            <div>
                                <a id="ID284" class="OH_CollapsibleArea_TitleAhref" href="javascript:void(0)" onclick="javascript:CA_Click('ID284','Expand','Collapse')" title="Collapse">
                                <img id="ID284_img" class="cl_CollapsibleArea_expanding OH_CollapsibleArea_Img" src="ms-xhelp:///?76555C51-8CF1-4FEB-81C4-BED857D94EBB_EN-US_Microsoft;/clear.gif" /><span class="OH_CollapsibleArea_Title">See Also</span></a>
<SCRIPT>addToCollapsibleControlSet('ID284');</SCRIPT>

                                <div class="OH_CollapsibleArea_HrDiv">
                                    <hr class="OH_CollapsibleArea_Hr" />
                                </div>
                            </div>
                        </div>
                        <div id="ID284_c" class="sectionblock">
                            <a id="seeAlsoToggle"></a>
                            <h4 class="subHeading">Other Resources</h4>
                            <div class="seeAlsoStyle">
                                <span><a class="mtps-internal-link" href="ms-xhelp:///?method=page&amp;id=4f882d94-262b-4494-b0a6-ba9ba1f5f177&amp;vendor=Microsoft&amp;topicVersion=110&amp;topicLocale=EN-US">Secure Coding Guidelines</a></span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="OH_footer">
        <p>
            © 2013 Microsoft Corporation. All rights reserved.</p>
        <div class="OH_feedbacklink">
            <a href="mailto:DevDocs@Microsoft.com?subject=MSDN%5e*bb763046%5e*VS%5e*110%5e*EN-US&amp;body=Visual%20Studio%20feedback%20policy%3a%20http%3a%2f%2fmsdn.microsoft.com%2fEN-US%2flibrary%2fee264131(VS.110).aspx">Send Feedback</a> on this topic to Microsoft.</div>
    </div>

</body>
</html>